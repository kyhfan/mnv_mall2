<?php
	session_start();
    /*
     * [???? ??????u ??????(STEP2-1)]
     *
     * ???????????????? ?? ??????? ???o?? ??????, ?????? ?????? ??????? ??????????? ??????©­? ??? ??n? ??????.     
     */

    /*
     * 1. ?????? ??????u ???? ????
     * 
     * ???????? ??????? ??n? ??????.(?????? ????? POST?? ????????)
     */
    $CST_PLATFORM               = $_POST["CST_PLATFORM"];				//LG???¡À??? ???? ???? ????(test:????, service:????)
    $CST_MID                    = $_POST["CST_MID"];					//?????????(LG???¡À??????? ???? ???????? ????????? ????????)
                                                                        //???? ?????? 't'?? ???? ??????? ????????.
    $LGD_MID                    = (("test" == $CST_PLATFORM)?"t":"").$CST_MID;  //?????????(???????)
    $LGD_OID                    = $_POST["LGD_OID"];					//??????(???????? ??????? ???????? ????????)
    $LGD_AMOUNT                 = $_POST["LGD_AMOUNT"];					//???????("," ?? ?????? ????????? ????????)
    $LGD_BUYER                  = $_POST["LGD_BUYER"];					//???????
    $LGD_PRODUCTINFO            = $_POST["LGD_PRODUCTINFO"];			//?????
    $LGD_BUYEREMAIL             = $_POST["LGD_BUYEREMAIL"];				//?????? ?????
    $LGD_CUSTOM_FIRSTPAY        = $_POST["LGD_CUSTOM_FIRSTPAY"];		//???????? ??????????
    $LGD_TIMESTAMP              = date(YmdHis);                         //????????
    $LGD_PCVIEWYN				= $_POST["LGD_PCVIEWYN"];				//???????? ??? ??? ??? ????(??????? ???? ??????? ???-->??????? ??? ????????? ???? ????)
	$LGD_CUSTOM_SKIN            = "SMART_XPAY2";                        //???????? ????a ???
    
	$configPath 				= "./lgdacom"; 						//LG???¡À??????? ?????? ???????("/conf/lgdacom.conf") ??? ????. 	    
    
    /*
     * ???????(??????) ???? ?????? ??o? ??? ??? LGD_CASNOTEURL ?? ??????? ??n? ??????. 
     */    
    $LGD_CASNOTEURL				= "http://www.store-chon.com/dev/cas_noteurl.php";    

    /*
     * LGD_RETURNURL ?? ??????? ??n? ??????. ???? ???? ???????? ?????? ??????? ??  ???????? ????. ??? ?¥ê??? ???? ???????y?.
     */    
    $LGD_RETURNURL				= "http://www.store-chon.com/dev/returnurl.php";  
	
	/*
	* ISP ?????? ?????? ???? ??????(???)
	*/
	$LGD_KVPMISPWAPURL		= "";
	$LGD_KVPMISPCANCELURL   = "";
	
	$LGD_MPILOTTEAPPCARDWAPURL = ""; //iOS ?????? ???
	   
	/*
	* ??????u ?????? ???? ??????(???)
	*/
	$LGD_MTRANSFERWAPURL 		= "";
	$LGD_MTRANSFERCANCELURL 	= "";   
	   
    
    /*
     *************************************************
     * 2. MD5 ??????? (???????? ??????) - BEGIN
     * 
     * MD5 ????????? ??? ???????? ???????? ???????. 
     *************************************************
     *
     * ??? ???? ????( LGD_MID + LGD_OID + LGD_AMOUNT + LGD_TIMESTAMP + LGD_MERTKEY )
     * LGD_MID          : ?????????
     * LGD_OID          : ??????
     * LGD_AMOUNT       : ???
     * LGD_TIMESTAMP    : ????????
     * LGD_MERTKEY      : ????MertKey (mertkey?? ?????????? -> ??????? -> ???????????????? ??????? ??????)
     *
     * MD5 ????????? ???? ?????? ????
     * LG???¡À??????? ????? ?????(MertKey)?? ????? ????(lgdacom/conf/mall.conf)?? ???? ?????? ??n? ??????.
     */
    require_once("./lgdacom/XPayClient.php");
    $xpay = new XPayClient($configPath, $LGD_PLATFORM);
   	if (!$xpay->Init_TX($LGD_MID)) {
        echo "LG???¡À??????? ?????? ????????? ?????????? ??? ??????? ?????n? ??????.<br/>";
        echo "mall.conf???? Mert Id = Mert Key ?? ???? ????? ???? ????.<br/><br/>";
        echo "??????? LG???¡À??? 1544-7772<br/>";
        exit; 
    }
    $LGD_HASHDATA = md5($LGD_MID.$LGD_OID.$LGD_AMOUNT.$LGD_TIMESTAMP.$xpay->config[$LGD_MID]);
    $LGD_CUSTOM_PROCESSTYPE = "TWOTR";
    /*
     *************************************************
     * 2. MD5 ??????? (???????? ??????) - END
     *************************************************
     */
    $CST_WINDOW_TYPE = "submit";										// ???????
    $payReqMap['CST_PLATFORM']           = $CST_PLATFORM;				// ????, ???? ????
    $payReqMap['CST_WINDOW_TYPE']        = $CST_WINDOW_TYPE;			// ???????
    $payReqMap['CST_MID']                = $CST_MID;					// ?????????
    $payReqMap['LGD_MID']                = $LGD_MID;					// ?????????
    $payReqMap['LGD_OID']                = $LGD_OID;					// ??????
    $payReqMap['LGD_BUYER']              = $LGD_BUYER;            		// ??????
    $payReqMap['LGD_PRODUCTINFO']        = $LGD_PRODUCTINFO;     		// ???????
    $payReqMap['LGD_AMOUNT']             = $LGD_AMOUNT;					// ???????
    $payReqMap['LGD_BUYEREMAIL']         = $LGD_BUYEREMAIL;				// ?????? ?????
    $payReqMap['LGD_CUSTOM_SKIN']        = $LGD_CUSTOM_SKIN;			// ????a SKIN
    $payReqMap['LGD_CUSTOM_PROCESSTYPE'] = $LGD_CUSTOM_PROCESSTYPE;		// ?????? o?????
    $payReqMap['LGD_TIMESTAMP']          = $LGD_TIMESTAMP;				// ????????
    $payReqMap['LGD_HASHDATA']           = $LGD_HASHDATA;				// MD5 ????????
    $payReqMap['LGD_RETURNURL']   		 = $LGD_RETURNURL;      		// ?????????????
    $payReqMap['LGD_VERSION']         	 = "PHP_Non-ActiveX_SmartXPay";	// ???????? (???????? ??????)
    $payReqMap['LGD_CUSTOM_FIRSTPAY']  	 = $LGD_CUSTOM_FIRSTPAY;		// ????? ????????
	$payReqMap['LGD_PCVIEWYN']			 = $LGD_PCVIEWYN;				// ???????? ??? ??? ??? ????(??????? ???? ??????? ???-->??????? ??? ????????? ???? ????)
	$payReqMap['LGD_CUSTOM_SWITCHINGTYPE']  = "SUBMIT";					// ?????? ???? ???? ?????? ???? ???
	
	
	//iOS ?????? ???
	$payReqMap['LGD_MPILOTTEAPPCARDWAPURL'] = $LGD_MPILOTTEAPPCARDWAPURL;
  
	/*
	****************************************************
	* ?????? ISP(????/BC)???????? ???? - BEGIN 
	****************************************************
	*/
	$payReqMap['LGD_KVPMISPWAPURL']		 	= $LGD_KVPMISPWAPURL;	
	$payReqMap['LGD_KVPMISPCANCELURL']  	= $LGD_KVPMISPCANCELURL;
	
	/*
	****************************************************
	* ?????? ISP(????/BC)???????? ????  - END
	****************************************************
	*/
		
	/*
	****************************************************
	* ??????u ???????? ???? - BEGIN 
	****************************************************
	*/
	$payReqMap['LGD_MTRANSFERWAPURL']		= $LGD_MTRANSFERWAPURL;	
	$payReqMap['LGD_MTRANSFERCANCELURL']  	= $LGD_MTRANSFERCANCELURL;
	
	/*
	****************************************************
	* ??????u ???????? ????  - END
	****************************************************
	*/
	
	
	/*
	****************************************************
	* ????? OS?? ISP(????/??), ??????u ???? ???? ??
	****************************************************
	- ???????: A (?????)
	- iOS: N
	- iOS?? ???, ???? N???? ???? ????
	*/
	$payReqMap['LGD_KVPMISPAUTOAPPYN']	= "A";		// ?????? ???? 
	$payReqMap['LGD_MTRANSFERAUTOAPPYN']= "A";		// ??????u ????

    // ???????(??????) ?????????? ??o? ???  ???/??? ????? ?–A??? ???? ???? LGD_CASNOTEURL ?????? LG ???¡À????? ??????? ???? .
    $payReqMap['LGD_CASNOTEURL'] = $LGD_CASNOTEURL;               // ??????? NOTEURL

    //Return URL???? ???? ??? ???? ?? ???o? ?????? ????.*/
    $payReqMap['LGD_RESPCODE']           = "";
    $payReqMap['LGD_RESPMSG']            = "";
    $payReqMap['LGD_PAYKEY']             = "";

    $_SESSION['PAYREQ_MAP'] = $payReqMap;
?>


<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=euc-kr">
<title>LG ???¡À??? eCredit???? ????????</title>
<script language="javascript" src="http://xpay.uplus.co.kr/xpay/js/xpay_crossplatform.js" type="text/javascript"></script>
<script type="text/javascript">


	var LGD_window_type = '<?= $CST_WINDOW_TYPE ?>'; 
/*
* ???????
*/
function launchCrossPlatform(){
      lgdwin = open_paymentwindow(document.getElementById('LGD_PAYINFO'), '<?= $CST_PLATFORM ?>', LGD_window_type);
}
/*
* FORM ??  ???? ????
*/
function getFormObject() {
        return document.getElementById("LGD_PAYINFO");
}

</script>
</head>
<body>
<form method="post" name="LGD_PAYINFO" id="LGD_PAYINFO" action="">
<table>
    <tr>
        <td>?????? ??? </td>
        <td><?= $LGD_BUYER ?></td>
    </tr>
    <tr>
        <td>??????? </td>
        <td><?= $LGD_PRODUCTINFO ?></td>
    </tr>
    <tr>
        <td>??????? </td>
        <td><?= $LGD_AMOUNT ?></td>
    </tr>
    <tr>
        <td>?????? ????? </td>
        <td><?= $LGD_BUYEREMAIL ?></td>
    </tr>
    <tr>
        <td>?????? </td>
        <td><?= $LGD_OID ?></td>
    </tr>
    <tr>
        <td colspan="2">* ??? ?? ??????u ??????? ??????? ??????n? ??????.</td>
    </tr>
    <tr>
        <td colspan="2"></td>
    </tr>    
    <tr>
        <td colspan="2">
		<input type="button" value="??????u" onclick="launchCrossPlatform();"/>         
        </td>
    </tr>    
</table>
<?php
  foreach ($payReqMap as $key => $value) {
    echo "<input type='hidden' name='$key' id='$key' value='$value'>";
  }
  var_dump($_SESSION);
?>
</form>
</body>
</html>

